<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="&lt;meta name=" google-site-verification> </head> <body> <p>"&gt; <meta name="msvalidate.01" content=""> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> </p> <title> Using Raster Calculator in QGIS GUI and Python Console to Make SR Blocks | Earth.etc </title> <meta name="author" content="Muhamad Nasir Lukman"> <meta name="description" content="Raster Calculator is a very useful tool to have at our disposal. Let's try it to make SR blocks"> <meta name="keywords" content="remote sensing, gis, image analysis, machine learning, geology, earth science, earth observation, geophysics, planetary science, satelite"> <meta property="og:site_name" content="Earth.etc"> <meta property="og:type" content="article"> <meta property="og:title" content="Earth.etc | Using Raster Calculator in QGIS GUI and Python Console to Make SR Blocks"> <meta property="og:url" content="https://nasirlukman.github.io/blog/2021/Raster-Calculator/"> <meta property="og:description" content="Raster Calculator is a very useful tool to have at our disposal. Let's try it to make SR blocks"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Using Raster Calculator in QGIS GUI and Python Console to Make SR Blocks"> <meta name="twitter:description" content="Raster Calculator is a very useful tool to have at our disposal. Let's try it to make SR blocks"> <script type="application/ld+json">
    {
        "author":
        {
            "@type": "Person",
            "name": "Muhamad Nasir Lukman"
        },
        "url": "https://nasirlukman.github.io/blog/2021/Raster-Calculator/",
        "@type": "BlogPosting",
        "description": "Raster Calculator is a very useful tool to have at our disposal. Let's try it to make SR blocks",
        "headline": "Using Raster Calculator in QGIS GUI and Python Console to Make SR Blocks",
        
        "sameAs": ["https://github.com/nasirlukman", "https://www.linkedin.com/in/nasirlukman"],
        
        "name": "Muhamad Nasir Lukman",
        "@context": "https://schema.org"
    }
  </script> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%8C%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://nasirlukman.github.io/blog/2021/Raster-Calculator/"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Earth.etc </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/post/index.html">post </a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Using Raster Calculator in QGIS GUI and Python Console to Make SR Blocks</h1> <p class="post-meta"> August 08, 2021 </p> <p class="post-tags"> <a href="/blog/2021"> <i class="fa-solid fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/gis"> <i class="fa-solid fa-hashtag fa-sm"></i> GIS,</a>   <a href="/blog/tag/qgis"> <i class="fa-solid fa-hashtag fa-sm"></i> QGIS,</a>   <a href="/blog/tag/raster"> <i class="fa-solid fa-hashtag fa-sm"></i> raster,</a>   <a href="/blog/tag/estimation"> <i class="fa-solid fa-hashtag fa-sm"></i> estimation,</a>   <a href="/blog/tag/coal"> <i class="fa-solid fa-hashtag fa-sm"></i> coal</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Raster Calculator is a robust way to execute a map algebra operation on raster image(s) using a user-friendly calculator-like format. It is a commonly available feature on any GIS software such as ArcGIS and QGis. Raster itself is one of the commonly used data formats in GIS which stores data in cells or pixels and organizes it into rows and columns (position) and each cell or pixel contains a value that represents certain information (visualized as colors). We can use a raster calculator to exploit these array-like properties of raster data to run any map algebra operation on each pixel in a robust way.</p> <p>The benefit of calculating SR in a raster calculator, rather than in any build-up function that your software already provides, is the flexibility of the operation that you can run. Now today we will try to perform a calculation to generate raster data containing a stripping ratio value of each pixel area given the topographic elevation data, and roof and floor elevation of each seam (we will use two seams for this example, let’s name it Seam A and Seam B).</p> <h2 id="raster-calculator-with-qgis-gui">Raster Calculator with QGIS GUI</h2> <h3 id="data-preparation">Data Preparation</h3> <p>Readily available raw elevation data is usually stored in a vector format of in [x,y,z] point text format; so first, we need to convert our data format. If our points data are already in a grid structure, we can perform conversion directly with vector to raster which in QGIS can be found in <strong><em>Raster&gt;Conversion&gt;Rasterized(Vector to Raster)</em></strong>. If our data point is not neatly and densely structured then it becomes an interpolation problem. There are a lot of interpolation methods that we can pick, depending on our initial data and our desired products. For this purpose, I will use IDW Interpolation that in QGIS can be found in <em>**Processing&gt;Toolbox&gt;Interpolation&gt;IDW Interpolation **</em>. Below is an example of IDW interpolation from my topography data.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/img/Raster_Calculator_files/Raster_Calculator_6_0-480.webp 480w,/img/Raster_Calculator_files/Raster_Calculator_6_0-800.webp 800w,/img/Raster_Calculator_files/Raster_Calculator_6_0-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/img/Raster_Calculator_files/Raster_Calculator_6_0.png" class="img-fluid rounded" width="100%" height="auto" alt="This image shows the result of performing IDW (Inverse Distance Weighting) interpolation on topographic elevation data points. The rasterization process converts the point data into a continuous grid representation of the terrain elevation." onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Image 1. IDW interpolation of topo data points. </div> <p>After all our data layers are ready in raster format, it is always a good idea to check the relationship of our datasets to get a better feel of what we are dealing with, for this example, we will try to make quick cross-sections. There is a very useful plugin in QGIS that I like to use to make a cross-section called <a href="https://plugins.qgis.org/plugins/profiletool/" rel="external nofollow noopener" target="_blank">Profile Tool</a>. You can install this plugin in <strong><em>Plugins&gt;Manage and install plugins…</em></strong> and search for Profile Tool in the search bar. In our data example today, we can see that we have two seams with pretty simple geometry that have a northwest dip direction.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/img/Raster_Calculator_files/Raster_Calculator_8_0-480.webp 480w,/img/Raster_Calculator_files/Raster_Calculator_8_0-800.webp 800w,/img/Raster_Calculator_files/Raster_Calculator_8_0-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/img/Raster_Calculator_files/Raster_Calculator_8_0.png" class="img-fluid rounded" width="100%" height="auto" alt="This image demonstrates a quick inspection of the elevation data's cross-section using the Profile Tool in QGIS. It provides a visual profile of the terrain, which helps in understanding the spatial relationships of the data and the geometry of the seams." onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Image 2. Quick inspection of the cross section with QGIS Profile Tool. </div> <h3 id="using-raster-calculator">Using Raster Calculator</h3> <p>After all of our data are ready in raster format, we can start to write our expression in the raster calculator. First, open up the raster calculator in <strong><em>Raster&gt;Raster calculator…</em></strong>. The GUI of the raster calculator is pretty straightforward and easy to get used to. every operation, variables, field, layer, etc are stored in the graphic interface so we can just write in using our mouse if we want. raster calculator syntax is based on <a href="https://desktop.arcgis.com/en/arcmap/latest/extensions/spatial-analyst/map-algebra/what-is-map-algebra.htm" rel="external nofollow noopener" target="_blank">map algebra</a>, which is basically an easier-to-read type of algebra.</p> <p>now if we want to make SR blocks, first we have to figure out the expression to calculate it. The simplest definition of SR is just the ratio between overburden and coal or any other valuable material of interest, both on its respective cost units. In this example, it is the ratio between overburden in bulk cubic meters (bcm) to coal in ton.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/img/Raster_Calculator_files/Raster_Calculator_12_0-480.webp 480w,/img/Raster_Calculator_files/Raster_Calculator_12_0-800.webp 800w,/img/Raster_Calculator_files/Raster_Calculator_12_0-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/img/Raster_Calculator_files/Raster_Calculator_12_0.png" class="img-fluid rounded" width="100%" height="auto" alt="This image presents the formula used in the Raster Calculator to compute the Stripping Ratio (SR). The SR is calculated as the ratio of overburden (bulk cubic meters) to coal (in tons), providing a valuable metric for mining operations." onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Image 3. A simple equation to compute SR blocks </div> <p>We can specify the resolution of our output raster by filling the column and row input with this formula:</p> <ul> <li>Column = (Xmax-Xmin)/desired resolution</li> <li>Row = (Ymax-Ymin)/desired resolution</li> </ul> <p>There is a good text indicator at the bottom of the window that tells us whether the expressions that we put are valid or invalid. If the expression is valid, then we can proceed and press OK, if it is invalid, then we need to check and fix our expression.</p> <p>Below is the results of our calculation above after I adjusted the Legends in layer properties.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/img/Raster_Calculator_files/Raster_Calculator_14_0-480.webp 480w,/img/Raster_Calculator_files/Raster_Calculator_14_0-800.webp 800w,/img/Raster_Calculator_files/Raster_Calculator_14_0-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/img/Raster_Calculator_files/Raster_Calculator_14_0.png" class="img-fluid rounded" width="100%" height="auto" alt="Image showing the results of the Stripping Ratio (SR) calculation are shown in this image. The output raster layer represents the calculated SR values for each pixel area, which can be visualized using appropriate color scales for easier interpretation." onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Image 4. SR block results. </div> <p>After we are familiar with how the raster calculator works, we can run any expression that we want, for our next example, We will try to calculate operating income blocks by subtracting operating cost from revenue.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/img/Raster_Calculator_files/Raster_Calculator_16_0-480.webp 480w,/img/Raster_Calculator_files/Raster_Calculator_16_0-800.webp 800w,/img/Raster_Calculator_files/Raster_Calculator_16_0-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/img/Raster_Calculator_files/Raster_Calculator_16_0.png" class="img-fluid rounded" width="100%" height="auto" alt="This image illustrates the use of the Raster Calculator to estimate operating income blocks. The operation involves subtracting operating costs from revenues, calculated using raster layers representing these variables." onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Image 5. Estimating operating income blocks using price and cost assumptions. </div> <p>This is the result of that operation:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/img/Raster_Calculator_files/Raster_Calculator_18_0-480.webp 480w,/img/Raster_Calculator_files/Raster_Calculator_18_0-800.webp 800w,/img/Raster_Calculator_files/Raster_Calculator_18_0-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/img/Raster_Calculator_files/Raster_Calculator_18_0.png" class="img-fluid rounded" width="100%" height="auto" alt="This image shows the resulting raster layer after calculating the operating income blocks. The raster represents the estimated operating income, with values in USD, which helps in evaluating the financial feasibility of the mining operation." onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Image 6. Estimated operation income blocks (in USD). </div> <h2 id="using-raster-calculator-in-qgis-python-console">Using Raster Calculator in QGIS Python Console</h2> <p>You can press Ctrl+Alt+P to open your QGIS python console. This code below will do just about the same as what we did previously in Qgis GUI, but with less clicking and layer rendering, and it’s reusable for your future needs. It is especially useful if you are experimenting with various expressions and input since you can tweak it much faster and easier. You can even modify this code a little bit and write a loop that will execute various expressions and save each of the results into different output files.</p> <blockquote> <p>If you want to reuse this code below you need to change the path and output variable, and all the parameters inside QgsRasterCalculator depending on your needs.</p> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>

<span class="n">path</span><span class="o">=</span><span class="sh">'</span><span class="s">C:/test/</span><span class="sh">'</span>
<span class="n">os</span><span class="p">.</span><span class="nf">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">file_list</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">lyr_dict</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">.tif</span><span class="sh">'</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="nb">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">layer_dict</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nc">QgsRasterLayer</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="nb">file</span><span class="p">),</span> <span class="n">file_name</span><span class="o">+</span><span class="sh">'</span><span class="s">@1</span><span class="sh">'</span><span class="p">]</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="sh">'</span><span class="s">block_SR.tif</span><span class="sh">'</span>
<span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">lyr</span> <span class="ow">in</span> <span class="n">lyr_dict</span><span class="p">:</span>
    <span class="n">ras</span> <span class="o">=</span> <span class="nc">QgsRasterCalculatorEntry</span><span class="p">()</span>
    <span class="n">ras</span><span class="p">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">lyr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ras</span><span class="p">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">lyr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ras</span><span class="p">.</span><span class="n">bandNumber</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">entries</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ras</span><span class="p">)</span>
    <span class="n">index</span><span class="o">+=</span><span class="mi">1</span>
    
<span class="n">calc</span> <span class="o">=</span> <span class="nc">QgsRasterCalculator</span><span class="p">(</span><span class="sh">'</span><span class="s">(((roof_a@1 - floor_a@1)+(roof_b@1 - floor_b@1))*10*1.3*65)</span><span class="se">\
</span><span class="s">                           -((((topo@1 - floor_b@1)-((roof_a@1 - floor_a@1)+(roof_b@1 - floor_b@1)))*10*2.2)</span><span class="se">\
</span><span class="s">                           +1.135*(((roof_a@1 - floor_a@1)+(roof_b@1 - floor_b@1))*10*1.3*15))</span><span class="sh">'</span><span class="p">,</span> 
                           <span class="n">output</span><span class="p">,</span> <span class="sh">'</span><span class="s">GTiff</span><span class="sh">'</span><span class="p">,</span> <span class="n">topo</span><span class="p">.</span><span class="nf">extent</span><span class="p">(),</span> <span class="nf">int</span><span class="p">(</span><span class="n">topo</span><span class="p">.</span><span class="nf">width</span><span class="p">()</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span> <span class="nf">int</span><span class="p">(</span><span class="n">topo</span><span class="p">.</span><span class="nf">height</span><span class="p">()</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span> <span class="n">entries</span><span class="p">)</span>
<span class="n">calc</span><span class="p">.</span><span class="nf">processCalculation</span><span class="p">()</span>
</code></pre></div></div> <p>Here is a quick breakdown of the code above:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>

<span class="n">path</span><span class="o">=</span><span class="sh">'</span><span class="s">C:/test/</span><span class="sh">'</span>
<span class="n">os</span><span class="p">.</span><span class="nf">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">file_list</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">lyr_dict</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">.tif</span><span class="sh">'</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="nb">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">layer_dict</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nc">QgsRasterLayer</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="nb">file</span><span class="p">),</span> <span class="n">file_name</span><span class="o">+</span><span class="sh">'</span><span class="s">@1</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div> <p>this code block will work to open up every raster (<em>.tif</em> extension) file in your working directory, so be sure to put all your needed raster files into one directory. After that, the loop will write those files into a layer dictionary. The dictionary will contain the name of the file without its extension as a key and its <code class="language-plaintext highlighter-rouge">QgsRasterLayer</code> class and names (which is the file name + <em>‘@1’</em>). This is the naming convention for a raster layer in which the number after <em>’@’</em> specifies the number of bands that the raster contains (in our case it is 1).</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="sh">'</span><span class="s">block_SR.tif</span><span class="sh">'</span>
<span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">lyr</span> <span class="ow">in</span> <span class="n">lyr_dict</span><span class="p">:</span>
    <span class="n">ras</span> <span class="o">=</span> <span class="nc">QgsRasterCalculatorEntry</span><span class="p">()</span>
    <span class="n">ras</span><span class="p">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">lyr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ras</span><span class="p">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">lyr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ras</span><span class="p">.</span><span class="n">bandNumber</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">entries</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ras</span><span class="p">)</span>
    <span class="n">index</span><span class="o">+=</span><span class="mi">1</span>
</code></pre></div></div> <p>In this block, we are using a <code class="language-plaintext highlighter-rouge">QgsRasterCalculatorEntry</code> class reference to create a list entry for every layer and its attributes such as naming reference, raster layer variable, and its band number from our <code class="language-plaintext highlighter-rouge">lyr_dict</code> dictionary. After that, we put all of our <code class="language-plaintext highlighter-rouge">QgsRasterCalculatorEntry</code> classes into a list called <code class="language-plaintext highlighter-rouge">entries</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calc</span> <span class="o">=</span> <span class="nc">QgsRasterCalculator</span><span class="p">(</span><span class="sh">'</span><span class="s">(((roof_a@1 - floor_a@1)+(roof_b@1 - floor_b@1))*10*1.3*65)</span><span class="se">\
</span><span class="s">                           -((((topo@1 - floor_b@1)-((roof_a@1 - floor_a@1)+(roof_b@1 - floor_b@1)))*10*2.2)</span><span class="se">\
</span><span class="s">                           +1.135*(((roof_a@1 - floor_a@1)+(roof_b@1 - floor_b@1))*10*1.3*15))</span><span class="sh">'</span><span class="p">,</span> 
                           <span class="n">output</span><span class="p">,</span> <span class="sh">'</span><span class="s">GTiff</span><span class="sh">'</span><span class="p">,</span> <span class="n">topo</span><span class="p">.</span><span class="nf">extent</span><span class="p">(),</span> <span class="nf">int</span><span class="p">(</span><span class="n">topo</span><span class="p">.</span><span class="nf">width</span><span class="p">()</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span> <span class="nf">int</span><span class="p">(</span><span class="n">topo</span><span class="p">.</span><span class="nf">height</span><span class="p">()</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span> <span class="n">entries</span><span class="p">)</span>
<span class="n">calc</span><span class="p">.</span><span class="nf">processCalculation</span><span class="p">()</span>
</code></pre></div></div> <p>This is where the actual calculation occurs. <code class="language-plaintext highlighter-rouge">QgsRasterCalculator</code> takes the following parameters to run:</p> <ul> <li>expression: which can be any expression you like, written in string format</li> <li>output file path also in string. Be sure to specify the extension behind the file name</li> <li>output format which is also in string. The most commonly used file format is GTiff for <em>.tif</em> file</li> <li>the extent from the output file which is usually the same as the input extent, or any numbers depending on your needs</li> <li>nrows and ncols which define the total number of rows and columns on a given extent. For this example, since I want a 10-meter resolution raster as output and I have a 1-meter resolution for the input, I just divided my input height and width by ten</li> <li> <code class="language-plaintext highlighter-rouge">entries</code> list</li> </ul> <p>Afterward, you can execute your calculation by using <code class="language-plaintext highlighter-rouge">processCalculation( )</code> function from <code class="language-plaintext highlighter-rouge">QgsRasterCalculator</code>. And the results will be the same as with our example using the GUI above.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/EDA/">Exploratory Data Analysis (EDA) for Hyperspectral Imagery</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/Earthquake-Playthrough-01/">Earthquake Playthrough 01</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/distance/">Different Distance Metrics Example in Spectral Unmixing</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ndfi/">Revisiting NDFI: A Flexible Index for Forest Monitoring and Beyond</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/illegal-mining/">Illegal Mining From Space</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Muhamad Nasir Lukman. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: July 13, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?906085072389244b4db0c89c5b1dd28d" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-NY818B7N0G"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-NY818B7N0G");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>